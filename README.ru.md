# Интеграция VK.com с MediaSession

> Этот юзерскрипт интегрирует плеер ВК с относительно новым [MediaSession API](https://w3c.github.io/mediasession/). Это весьма полезно если вы используете расширение интеграции с окружением рабочего стола (например, [Plasma Browser Integration для KDE](https://community.kde.org/Plasma/Browser_Integration)). Этот скрипт также может отправлять уведомления о текущем играющем треке.

|             Без скрипта             |           Со скриптом            |
| :---------------------------------: | :------------------------------: |
| ![Screenshot](examples/without.jpg) | ![Screenshot](examples/with.jpg) |
| <ul><li>Невозможно полноценно управлять проигрыванием</li><li>Не отображается название трека и исполнитель</li></ul> | <ul><li>Динамично менающиеся элементы управления проигрыванием</li><li>Отображаемые обложка<sup>**1**</sup>, исполнитель, заголовок и альбом/плейлист</li><li>Уведомление о текущем треке<sup>**2**</sup></li><li>Поведение кнопки «прошлый трек» как в Spotify<sup>**3**</sup></li></ul> |

<sup>1</sup> *К сожалению, ВКонтакте не загружает информацию об альбоме при проигрывании треков из обычных плейлистов, доступна только маленькая обложка. Однако, если вы запустили проигрывание альбома, большая обложка будет загружена. Эту проблему невозможно исправить.*

<sup>2</sup> *Уведомления приходят только если вы включили их на [странице настроек][vk_settings] и дали разрешение сайту vk.com отправлять их.*

<sup>3</sup> *Если плеер играет трек более двух секунд, нажатие на кнопку «прошлый трек» будет перематывать в самое начала текущего трека вместо перехода к прошлому треку. Это так же может быть настроено на [странице настроек][vk_settings].*

## Как использовать этот скрипт?

Вам нужно будет установить юзерскрипт через предпочтительное расширение для этого ([Tampermonkey](https://www.tampermonkey.net/), [Greasemonkey](https://www.greasespot.net/), [Violentmonkey](https://violentmonkey.github.io/)). По нажатию на следующую кнопку должен открыться диалог установки.

[![Кнопка установки](https://img.shields.io/badge/VK%20Audio%20Integration-%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%B8%D1%82%D1%8C-brightgreen)](https://github.com/Sasha-Sorokin/vkaintegra/raw/master/vkaintegra.user.js)

**По-прежнему необходима системная интеграция, которая будет использовать эти данные**. KDE предоставляет расширение Plasma Browser Integration для Firefox и Chrome, которое использует MediaSession и мониторинг аудио и видео элементов на странице, чтобы предоставить вам элементы управления и отображать информацию о медиа. [Подробнее →](https://vk.com/@kde_ru-plasma-browser-integration-15)

## Сообщения об ошибках

Юзерскрипт полагается на расскрытое API на сайте ВКонтакте, к которому нет документации, поэтому оно может некорректно себя вести в некоторых ситуациях. Если у вас возникли проблемы с этим скриптом, пожалуйста сообщите о них в [секции Issues →](https://github.com/Sasha-Sorokin/vkaintegra/issues)

[vk_settings]: https://vk.com/settings
